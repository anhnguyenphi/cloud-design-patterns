Follow this article: https://konghq.com/blog/how-to-design-a-scalable-rate-limiting-algorithm/